<?xml version="1.0"?>
  <database name="TRIGGER PMB_RATINGSAUTHOR">
    <trigger name="PMB_RATINGSAUTHOR" table="PMB_AUTHOR" fires="before" insert="true" update="true" delete="false" foreach="row">
      <body><![CDATA[PARTNERID VARCHAR(32);
RATIN VARCHAR(60);
EMAIL VARCHAR(60);
CBLOCATION VARCHAR(32);
BEGIN
	PARTNERID := :NEW.C_BPARTNER_ID;
	

	IF PARTNERID IS NOT NULL THEN

		SELECT EM_PMB_RATINGSPARTNER,EM_OPCRM_BP_EMAIL INTO RATIN,EMAIL FROM C_BPARTNER WHERE C_BPARTNER_ID = PARTNERID;
		
		SELECT C_BPARTNER_LOCATION_ID INTO CBLOCATION FROM C_BPARTNER_LOCATION WHERE C_BPARTNER_ID = PARTNERID LIMIT 1;
		--RAISE ratin;
		
		IF RATIN IS NOT NULL THEN
			--SELECT * FROM C_BPARTNER
			IF RATIN IS NOT NULL THEN 
			 :NEW.RATINGS = RATIN;
			END IF;

			IF EMAIL IS NOT NULL THEN 
			 :NEW.EMAIL = EMAIL;
			END IF;

			IF CBLOCATION IS NOT NULL THEN
			 :NEW.C_BPARTNER_LOCATION_ID = CBLOCATION;
			END IF;
			 --RAISE NO_DATA_FOUND||RATIN;
		END IF;
	END IF;

RETURN NEW; 
END PMB_RATINGSAUTHOR
]]></body>
    </trigger>
  </database>
